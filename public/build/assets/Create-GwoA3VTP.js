import{q as L,v as T,r as c,j as t,$ as q}from"./app-CwGju8CY.js";import{A}from"./AuthenticatedLayout-CUluGPaX.js";import{C as I,S as x}from"./sweetalert2.esm.all-BOihAQ_-.js";import{C as R}from"./Card-mzitNwf1.js";import{I as d}from"./Input-CN6BAMDO.js";import{B as j}from"./Button-dMKSO52k.js";import{E as B}from"./Editor-h8U21iob.js";import{M}from"./Map-DIRzbPuu.js";import"./ApplicationLogo-32h4bEtG.js";import"./transition-GvcU358S.js";import"./constants-BAQv67Aw.js";import"./helper-BrshmBKU.js";import"./index-BpiK8j0g.js";function Y({auth:b}){const{categories:v,tickets:k,regions:N}=L().props,{data:a,setData:i,post:y,errors:l,progress:p}=T({title:"",description:"",officehours:"",category_id:"",region_id:"",ticket_ids:{},phone:"",address:"",latitude:"",longitude:"",image:[]}),[u,_]=c.useState(""),[h,m]=c.useState([51.505,-.09]),[C,w]=c.useState("Default Location"),S=c.useRef();c.useEffect(()=>{const e=parseFloat(a.latitude),s=parseFloat(a.longitude);!isNaN(e)&&!isNaN(s)&&m([e,s])},[a.latitude,a.longitude]);const D=e=>{e.preventDefault();const s=new FormData;s.append("title",a.title),s.append("description",a.description),s.append("officehours",a.officehours),s.append("category_id",a.category_id),s.append("address",a.address),s.append("latitude",a.latitude),s.append("longitude",a.longitude);for(let r=0;r<a.image.length;r++)s.append("image[]",a.image[r]);Object.values(a.ticket_ids).filter(Boolean).forEach((r,n)=>{s.append(`ticket_ids[${n}]`,r)}),y(route("locations.store"),{data:s,forceFormData:!0})},E=async e=>{if(e.preventDefault(),!u.trim())return;const o=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(u)}`;try{const n=await(await fetch(o)).json();if(n.length>0){const f=parseFloat(n[0].lat),g=parseFloat(n[0].lon);m([f,g]),i("latitude",f),i("longitude",g),i("address",n[0].display_name),w(n[0].display_name)}else x.fire({title:"Failed!",text:"Location not found!",icon:"error",showConfirmButton:!1,timer:1500})}catch{x.fire({title:"Failed!",text:"Failed to search location!",icon:"error",showConfirmButton:!1,timer:1500})}},F=e=>{e.key==="Enter"&&E(e)};return t.jsxs(A,{user:b.user,header:t.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Add New Location"}),children:[t.jsx(q,{title:"Add Location"}),t.jsx(I,{children:t.jsx(R,{title:"Add Location",children:t.jsxs("form",{onSubmit:D,children:[t.jsx(d,{label:"Title",value:a.title,onChange:e=>i("title",e.target.value),errors:l.title}),t.jsx("label",{className:"block mb-1 font-semibold",children:"Description"}),t.jsx(B,{apiKey:"zht8uetqj2ra0t0q9nf5ueeiz4pjutf881gfnps3iq6kjhu5",value:a.description,init:{height:300,menubar:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help"},onEditorChange:e=>i("description",e)}),l.description&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.description}),t.jsx(d,{label:"Office Hours",value:a.officehours,onChange:e=>i("officehours",e.target.value),errors:l.officehours}),t.jsx(d,{label:"Phone",value:a.phone,onChange:e=>i("phone",e.target.value),errors:l.phone}),t.jsx(d,{label:"Address",value:a.address,onChange:e=>i("address",e.target.value),errors:l.address}),t.jsx(d,{label:"Latitude",value:a.latitude,onChange:e=>i("latitude",e.target.value),errors:l.latitude}),t.jsx(d,{label:"Longitude",value:a.longitude,onChange:e=>i("longitude",e.target.value),errors:l.longitude}),t.jsxs("div",{className:"my-4",children:[t.jsx(d,{label:"Search Location",type:"text",ref:S,value:u,onChange:e=>_(e.target.value),onKeyDown:F,placeholder:"Search for a place..."}),t.jsx("div",{className:"w-full mt-5",children:t.jsx("div",{id:"maps",className:"h-[600px] w-full sticky top-36 rounded-3xl overflow-hidden",children:t.jsx(M,{lat:h[0],long:h[1],onMarkerDragEnd:({lat:e,lng:s})=>{i("latitude",e),i("longitude",s),m([e,s])},customMarker:C})})})]}),t.jsx("label",{className:"block",children:"Category"}),t.jsxs("select",{value:a.category_id,onChange:e=>i("category_id",e.target.value),className:"w-full p-2 border rounded-sm mb-4",children:[t.jsx("option",{value:"",children:"Select Category"}),v.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),l.category_id&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.category_id}),t.jsx("label",{className:"block",children:"Region"}),t.jsxs("select",{value:a.region_id,onChange:e=>i("region_id",e.target.value),className:"w-full p-2 border rounded-sm mb-4",children:[t.jsx("option",{value:"",children:"Select Region"}),N.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),l.region_id&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.region_id}),t.jsx("label",{className:"block",children:"Ticket"}),Object.entries(k).map(([e,s])=>t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 block",children:[e," Tickets"]}),t.jsxs("select",{value:a.ticket_ids[e]||"",onChange:o=>i("ticket_ids",{...a.ticket_ids,[e]:o.target.value}),className:"w-full p-2 border rounded-sm",children:[t.jsxs("option",{value:"",children:["Select ",e," Ticket"]}),s.map(o=>t.jsx("option",{value:o.id,children:o.ticket_code},o.id))]})]},e)),l.ticket_ids&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.ticket_ids}),t.jsx("label",{className:"block mb-1 font-semibold",children:"Images (multiple allowed)"}),t.jsx("input",{type:"file",multiple:!0,onChange:e=>i("image",e.target.files),className:"mt-2"}),l.image&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:l.image}),p&&t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-4",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${p.percentage}%`}})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(j,{type:"submit",label:"Submit"}),t.jsx(j,{type:"cancel",url:route("locations.index"),label:"cancel"})]})]})})})]})}export{Y as default};
