import{q,v as F,r as c,j as t,$ as R}from"./app-CwGju8CY.js";import{A as T}from"./AuthenticatedLayout-CUluGPaX.js";import{C as M}from"./sweetalert2.esm.all-BOihAQ_-.js";import{C as B}from"./Card-mzitNwf1.js";import{I as n}from"./Input-CN6BAMDO.js";import{B as f}from"./Button-dMKSO52k.js";import{E as I}from"./Editor-h8U21iob.js";import{M as $}from"./Map-DIRzbPuu.js";import"./ApplicationLogo-32h4bEtG.js";import"./transition-GvcU358S.js";import"./constants-BAQv67Aw.js";import"./helper-BrshmBKU.js";import"./index-BpiK8j0g.js";function Y({auth:j}){const{location:l,categories:v,tickets:b,regions:N,progress:h}=q().props,{data:a,setData:s,post:k,errors:i}=F({title:l.title,description:l.description,officehours:l.officehours,category_id:l.category_id,ticket_ids:l.ticket_ids||{},region_id:l.region_id,phone:l.phone,address:l.address,latitude:l.latitude,longitude:l.longitude,image:null,_method:"put"}),[u,y]=c.useState(""),[p,m]=c.useState([a.latitude,a.longitude]),[_,C]=c.useState("Default Location"),w=c.useRef();c.useEffect(()=>{const e=parseFloat(a.latitude),o=parseFloat(a.longitude);!isNaN(e)&&!isNaN(o)&&m([e,o])},[a.latitude,a.longitude]);const S=e=>{e.preventDefault(),k(route("locations.update",l.id))},E=async e=>{if(e.preventDefault(),!u.trim())return;const r=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(u)}`;try{const d=await(await fetch(r)).json();if(d.length>0){const x=parseFloat(d[0].lat),g=parseFloat(d[0].lon);m([x,g]),s("latitude",x),s("longitude",g),s("address",d[0].display_name),C(d[0].display_name)}else Swal.fire({title:"Failed!",text:"Location not found!",icon:"error",showConfirmButton:!1,timer:1500})}catch{Swal.fire({title:"Failed!",text:"Failed to search location!",icon:"error",showConfirmButton:!1,timer:1500})}},L=e=>{e.key==="Enter"&&E(e)};return t.jsxs(T,{user:j.user,header:t.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Edit Location"}),children:[t.jsx(R,{title:"Edit Location"}),t.jsx(M,{children:t.jsx(B,{title:"Edit Location",children:t.jsxs("form",{onSubmit:S,children:[t.jsx(n,{label:"Title",value:a.title,onChange:e=>s("title",e.target.value),errors:i.title}),t.jsxs("div",{children:[t.jsx("label",{className:"block mb-2",children:"Description"}),t.jsx(I,{apiKey:"zht8uetqj2ra0t0q9nf5ueeiz4pjutf881gfnps3iq6kjhu5",value:a.description,init:{height:300,menubar:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help"},onEditorChange:e=>s("description",e)}),i.description&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.description}),t.jsx(n,{label:"Office Hours",value:a.officehours,onChange:e=>s("officehours",e.target.value),errors:i.officehours}),t.jsx(n,{label:"Phone",value:a.phone,onChange:e=>s("phone",e.target.value),errors:i.phone}),t.jsx(n,{label:"Address",value:a.address,onChange:e=>s("address",e.target.value),errors:i.address}),t.jsx(n,{label:"Latitude",value:a.latitude,onChange:e=>s("latitude",e.target.value),errors:i.latitude}),t.jsx(n,{label:"Longitude",value:a.longitude,onChange:e=>s("longitude",e.target.value),errors:i.longitude}),t.jsxs("div",{className:"my-4",children:[t.jsx(n,{label:"Search Location",type:"text",ref:w,value:u,onChange:e=>y(e.target.value),onKeyDown:L,placeholder:"Search for a place..."}),t.jsx("div",{className:"w-full mt-5",children:t.jsx("div",{id:"maps",className:"h-[600px] w-full sticky top-36 rounded-3xl overflow-hidden",children:t.jsx($,{lat:p[0],long:p[1],onMarkerDragEnd:({lat:e,lng:o})=>{s("latitude",e),s("longitude",o),m([e,o])},customMarker:_})})})]}),t.jsx("label",{className:"block mb-2",children:"Category"}),t.jsxs("select",{value:a.category_id,onChange:e=>s("category_id",e.target.value),className:"w-full p-2 border rounded-sm",children:[t.jsx("option",{value:"",children:"Select Category"}),v.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),i.category_id&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.category_id})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Region"}),t.jsxs("select",{value:a.region_id,onChange:e=>s("region_id",e.target.value),className:"w-full p-2 border rounded-sm mb-4",children:[t.jsx("option",{value:"",children:"Select Region"}),N.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),i.region_id&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.region_id})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Ticket"}),Object.entries(b).map(([e,o])=>t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 block",children:[e," Tickets"]}),t.jsxs("select",{value:a.ticket_ids[e]||"",onChange:r=>s("ticket_ids",{...a.ticket_ids,[e]:r.target.value}),className:"w-full p-2 border rounded-sm",children:[t.jsxs("option",{value:"",children:["Select ",e," Ticket"]}),o.map(r=>t.jsx("option",{value:r.id,children:r.ticket_code},r.id))]})]},e)),i.ticket_ids&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.ticket_ids})]}),t.jsxs("label",{className:"block mb-1 font-semibold",children:["Upload New Images"," "]}),t.jsx("input",{type:"file",multiple:!0,onChange:e=>s("image",e.target.files),className:"mt-2"}),i.image&&t.jsx("div",{className:"text-red-500 text-sm mt-1",children:i.image}),h&&t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-4",children:t.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${h.percentage}%`}})}),t.jsxs("div",{className:"flex gap-2 mt-6",children:[t.jsx(f,{type:"submit",label:"Save Changes"}),t.jsx(f,{type:"cancel",url:route("locations.index"),label:"cancel"})]})]})})})]})}export{Y as default};
